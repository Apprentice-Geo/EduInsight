<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>æ­£åœ¨åˆ†æ - å­¦æƒ…é¢„è­¦åˆ†æç³»ç»Ÿ</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
        padding: 50px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        margin: 0;
        color: white;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        padding: 40px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }
      h1 {
        font-size: 28px;
        margin-bottom: 20px;
        color: white;
      }
      .user-info {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 30px;
        font-size: 18px;
      }
      .loader {
        border: 8px solid rgba(255, 255, 255, 0.2);
        border-top: 8px solid #fff;
        border-radius: 50%;
        width: 80px;
        height: 80px;
        animation: spin 1.5s linear infinite;
        margin: 30px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .status-text {
        font-size: 18px;
        margin: 20px 0;
        line-height: 1.6;
      }
      .progress-steps {
        text-align: left;
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .step {
        margin: 10px 0;
        padding: 8px 0;
        font-size: 16px;
      }
      .step.active {
        color: #ffd700;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ¤– AIæ­£åœ¨åˆ†ææ‚¨çš„æ•°æ®...</h1>

      <div class="user-info">
        <strong>{{ username }}</strong>ï¼Œæ‚¨çš„åˆ†æä»»åŠ¡å·²å¼€å§‹
      </div>

      <div class="loader"></div>

      <div class="status-text">
        ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨æœºå™¨å­¦ä¹ ç®—æ³•åˆ†æå­¦ç”Ÿæ•°æ®ï¼Œè¯·ç¨å€™ç‰‡åˆ»...
      </div>

      <div class="progress-steps">
        <div class="step active">âœ… æ•°æ®ä¸Šä¼ å®Œæˆ</div>
        <div class="step active">ğŸ”„ ç‰¹å¾æå–ä¸­...</div>
        <div class="step">ğŸ§  æœºå™¨å­¦ä¹ åˆ†æ</div>
        <div class="step">ğŸ“Š ç”Ÿæˆé¢„è­¦æŠ¥å‘Š</div>
        <div class="step">âœ¨ åˆ†æå®Œæˆ</div>
      </div>

      <p class="status-text">åˆ†æå®Œæˆåå°†è‡ªåŠ¨è·³è½¬åˆ°ç»“æœé¡µé¢</p>
    </div>

    <script>
      const userId = "{{ user_id }}";
      let stepIndex = 1;
      const steps = document.querySelectorAll(".step");

      // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
      const updateProgress = () => {
        if (stepIndex < steps.length - 1) {
          steps[stepIndex].classList.add("active");
          stepIndex++;
        }
      };

      const checkStatus = () => {
        fetch(`/api/status/${userId}`)
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "completed") {
              // å®Œæˆæ‰€æœ‰æ­¥éª¤
              steps.forEach((step) => step.classList.add("active"));
              setTimeout(() => {
                window.location.href = `/results/${userId}`;
              }, 1500);
            } else if (data.status === "error") {
              document.querySelector(".status-text").innerHTML =
                "âŒ åˆ†æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·è¿”å›é‡æ–°ä¸Šä¼ æ–‡ä»¶";
            } else {
              // æ›´æ–°è¿›åº¦
              updateProgress();
              // 5ç§’åå†æ¬¡æ£€æŸ¥
              setTimeout(checkStatus, 5000);
            }
          })
          .catch((error) => {
            console.error("Error checking status:", error);
            // å‡ºé”™ä¹Ÿç»§ç»­é‡è¯•
            setTimeout(checkStatus, 8000);
          });
      };

      // é¡µé¢åŠ è½½åå¼€å§‹æ£€æŸ¥çŠ¶æ€å’Œè¿›åº¦åŠ¨ç”»
      window.onload = () => {
        checkStatus();
        // æ¯3ç§’æ›´æ–°ä¸€æ¬¡è¿›åº¦æ˜¾ç¤º
        setInterval(updateProgress, 3000);
      };
    </script>
  </body>
</html>
